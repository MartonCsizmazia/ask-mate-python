{% extends "layout.html" %}
{% block title %}Question{% endblock %}
{% block head %}
{% endblock %}
{% block content %}
    <table id="list-table">
        <tbody>
            <tr id="list-elements">
                <td id="list-vote">{{ question['vote_number'] }} <br>votes</td>
                <td id="list-view">{{ question['view_number'] }} <br>views</td>
                <td id="list-title">{{ question['message'] }}<p id="list-time">
                    {{ question['submission_time'] }}</p>
                </td>
            </tr>
        </tbody>
    </table>
    <br>
    <table>
        {% for tag in tags %}
            <td>
                {{ tag['name'] }} <form action="/question/{{ question['id'] }}/tag/{{ tag['id'] }}delete">
                <input type="submit" value="X"/>
                </form>
            </td>
        {% endfor %}
    </table>
    <br>
    {% if question_comments != None %}
    <table>
    {% for question_comment in question_comments %}
        <tr>
        <td>
            {{ question_comment['message'] }}
        </td><td>
            {{ question_comment['submission_time'] }}
        </td><td>
            {% if question_comment['edited_count']== 0 %}
                This answer has not been edited
            {% else %}
                Edited: {{ question_comment['edited_count'] }} times
            {% endif %}
        </td><td>
            <form action="/comment/{{ question_comment.id }}/edit">
                <input type="submit" value="Edit comment"/>
            </form>
            <form action="/comment/{{ question_comment.id }}/delete">
                    <input type="submit" value="Delete comment" onclick="return confirm('Are you sure you want to delete?');"/>
            </form>
        </td>
        </tr>
    {% endfor %}
    </table>
    {% endif %}
    <p>
    <form action="/question/{{ question['id'] }}/edit">
        <input type="submit" value="Edit question"/>
    </form>
    <form action="/question/{{ question['id'] }}/delete">
        <input type="submit" value="Delete question"/>
    </form>
    <form action="/question/{{ question['id'] }}/new-comment">
        <input type="submit" value="Add comment"/>
    </form>
    <form action="/question/{{ question['id'] }}/new-tag">
        <input type="submit" value="Add tag">
    </form>
    <form action="/">
        <input type="submit" value="Go back to Questions"/>
    </form>
    <form action="/question/{{ question['id'] }}/vote-up">
        <input type="submit" value="👍"/>
    </form>
    <form action="/question/{{ question['id'] }}/vote-down">
        <input type="submit" value="👎"/>
    </form>
    </p>
    {% if answers != [] %}
        <h1>
            Try this:
        </h1>
        <br>
            {% for answer in answers | sort(reverse=True, attribute="submission_time") %}
            <table>
            <tbody>
                <tr>
                    <td id="list-vote">{{ answer['vote_number'] }} <br>votes</td>
                    <td id="list-title">{{ answer['message'] }}<p id="list-time">
                        {{ answer['submission_time'] }}</p></td>
                    <td><img src="{{ answer['image'] }}"></td>
                    <td>
                        <form action="/answer/{{ answer['id'] }}/new-comment">
                            <input type="submit" value="Comment this answer"/>
                        </form>
                        <form action="/answer/{{ answer['id'] }}/edit">
                            <input type="submit" value="Edit answer"/>
                        </form>
                        <form action="/answer/{{ answer['id'] }}/delete">
                            <input type="submit" value="Delete answer"/>
                        </form>
                        <form action="/answer/{{ answer['id'] }}/vote-up">
                            <input type="submit" value="👍"/>
                        </form>
                        <form action="/answer/{{ answer['id'] }}/vote-down">
                            <input type="submit" value="👎"/>
                        </form>
                    </td>
                </tr></tbody></table>
                <table>
                    {% if answer_comments != None %}
                    {% for answer_comment in answer_comments %}
                    {% if answer_comment.answer_id ==  answer.id %}
                        <tr>
                        <td>
                            {{ answer_comment['message'] }}
                        </td><td>
                            {{ answer_comment['submission_time'] }}
                        </td><td>
                            {% if answer_comment['edited_count']== 0 %}
                                This answer has not been edited
                            {% else %}
                                Edited: {{ answer_comment['edited_count'] }} times
                            {% endif %}
                        </td><td>

                            <form action="/comment/{{ answer_comment.id }}/edit">
                                    <input type="submit" value="Edit comment"/>
                            </form>
                            <form action="/comment/{{ answer_comment.id }}/delete">
                                    <input type="submit" value="Delete comment" onclick="return confirm('Are you sure you want to delete?');"/>
                            </form>
                        </td>
                        </tr>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                </table>
            {% endfor %}

    {% endif %}
    <p>
    <form action="/question/{{ question['id'] }}/new-answer">
        <input type="submit" value="Post an answer"/>
    </form>
    </p>
{% endblock %}